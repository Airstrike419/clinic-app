<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Saad Sabry Alzubaidy - Surgical Dashboard</title>
    <style>
        :root { --primary: #004a99; --accent: #00cae3; --danger: #e91e63; --success: #4caf50; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; color: #333; }
        header { background: var(--primary); color: white; padding: 15px 20px; text-align: center; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
        
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h3 { border-left: 4px solid var(--primary); padding-left: 10px; color: var(--primary); margin-top: 0; }
        
        /* Form elements */
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        
        /* Patient List */
        .pt-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; position: relative; }
        .pt-item:hover { background: #f8faff; }
        .badge { font-size: 10px; padding: 3px 8px; border-radius: 10px; color: white; margin-right: 5px; }
        .op-badge { background: var(--danger); }
        .fup-badge { background: var(--accent); }

        /* Detail Sections */
        .section-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #eaeaea; }
        .label { font-weight: bold; font-size: 12px; color: #666; text-transform: uppercase; }
        
        /* Reminders Panel */
        .reminders { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .rem-card { min-width: 200px; background: white; padding: 15px; border-radius: 10px; border-top: 4px solid var(--danger); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0">Dr. Saad Sabry Alzubaidy</h2>
    <div style="font-size: 0.8em; opacity: 0.9;">Surgical Clinic | Baghdad, Hai Al-Jameaa</div>
</header>

<div class="container">
    <div class="sidebar">
        <div class="card">
            <h3>Register Patient</h3>
            <input type="text" id="newName" placeholder="Patient Full Name">
            <input type="text" id="newComplaint" placeholder="Chief Complaint">
            <button onclick="saveToCloud()" id="saveBtn">Create Digital File</button>
        </div>
        
        <div class="card">
            <h3>Patient Records</h3>
            <input type="text" onkeyup="filterList(this.value)" placeholder="Search by name...">
            <div id="patientList" style="max-height: 500px; overflow-y: auto;">
                <p style="text-align:center; color:#999;">Syncing with cloud...</p>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="reminderSection" class="reminders"></div>

        <div id="emptyState" class="card" style="text-align:center; padding: 100px 0;">
            <p style="color:#999;">Select a patient to view investigations, surgical plans, and follow-ups.</p>
        </div>

        <div id="patientDetail" class="card" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 id="viewName" style="margin:0; color:var(--primary);">Patient Name</h2>
                <div id="ptBadges"></div>
            </div>

            <div class="section-box">
                <div class="label">Initial Presentation & History</div>
                <textarea id="viewPresentation" rows="2"></textarea>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div class="section-box">
                    <div class="label">Investigations (Imaging/Labs)</div>
                    <textarea id="viewInvestigations" placeholder="US, CT, MRI, Biopsy results..." rows="4"></textarea>
                </div>
                <div class="section-box">
                    <div class="label">Management (Mx) & Plan</div>
                    <textarea id="viewMx" placeholder="Current treatment or surgical plan..." rows="4"></textarea>
                </div>
            </div>

            <div class="section-box">
                <div class="label">Visit Timeline & Progress Notes</div>
                <textarea id="viewVisits" placeholder="Date: Note on this visit..." rows="5"></textarea>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; background:#fff5f7; padding:15px; border-radius:8px;">
                <div>
                    <div class="label" style="color:var(--danger)">Operation Detail</div>
                    <input type="date" id="viewOpDate">
                    <input type="text" id="viewOpDetail" placeholder="Type of surgery">
                </div>
                <div>
                    <div class="label" style="color:var(--accent)">Next Follow-up</div>
                    <input type="date" id="viewFollowUp">
                </div>
            </div>

            <button onclick="updateCloud()" style="background:var(--success); margin-top:20px;">Save All Patient Details</button>
        </div>
    </div>
</div>

<script>
    // 1. PASTE YOUR URL HERE
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxa82IJtJAOdrsBV2w8uLMoViK3k3xb9TDbTY_rrqxvpUJKMUYs_iu6TAy5HzfJYKPb/exec'; 
    
    let patients = [];
    let currentIdx = null;

    async function loadData() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            patients = data.slice(1).map(r => ({
                name: r[0], complaint: r[1], presentation: r[2],
                investigations: r[3], visits: r[4], mx: r[5],
                opDate: r[6], opDetail: r[7], followUp: r[8]
            }));
            renderList();
            renderReminders();
        } catch(e) { console.log("Sync Error"); }
    }

    function renderList(listData = patients) {
        const list = document.getElementById('patientList');
        list.innerHTML = '';
        listData.forEach((pt, i) => {
            list.innerHTML += `
                <div class="pt-item" onclick="showPatient(${i})">
                    <strong>${pt.name}</strong><br>
                    <small>${pt.complaint}</small>
                    <div style="margin-top:5px;">
                        ${pt.opDate ? '<span class="badge op-badge">Surgery</span>' : ''}
                        ${pt.followUp ? '<span class="badge fup-badge">Follow-up</span>' : ''}
                    </div>
                </div>`;
        });
    }

    function renderReminders() {
        const rem = document.getElementById('reminderSection');
        rem.innerHTML = '';
        const today = new Date().toISOString().split('T')[0];
        
        patients.filter(p => p.opDate === today).forEach(p => {
            rem.innerHTML += `<div class="rem-card"><strong>Today's Surgery:</strong><br>${p.name}<br><small>${p.opDetail}</small></div>`;
        });
    }

    function showPatient(i) {
        currentIdx = i;
        const pt = patients[i];
        document.getElementById('emptyState').style.display = 'none';
        document.getElementById('patientDetail').style.display = 'block';
        
        document.getElementById('viewName').innerText = pt.name;
        document.getElementById('viewPresentation').value = pt.presentation || '';
        document.getElementById('viewInvestigations').value = pt.investigations || '';
        document.getElementById('viewMx').value = pt.mx || '';
        document.getElementById('viewVisits').value = pt.visits || '';
        document.getElementById('viewOpDate').value = pt.opDate || '';
        document.getElementById('viewOpDetail').value = pt.opDetail || '';
        document.getElementById('viewFollowUp').value = pt.followUp || '';
    }

    async function saveToCloud() {
        const name = document.getElementById('newName').value;
        if(!name) return alert("Enter Name");
        const params = new URLSearchParams({ name: name, complaint: document.getElementById('newComplaint').value });
        await fetch(SCRIPT_URL, { method: 'POST', body: params, mode: 'no-cors' });
        location.reload();
    }

    async function updateCloud() {
        const pt = patients[currentIdx];
        const params = new URLSearchParams({
            name: pt.name,
            complaint: pt.complaint,
            presentation: document.getElementById('viewPresentation').value,
            investigations: document.getElementById('viewInvestigations').value,
            visits: document.getElementById('viewVisits').value,
            mx: document.getElementById('viewMx').value,
            opDate: document.getElementById('viewOpDate').value,
            opDetail: document.getElementById('viewOpDetail').value,
            followUp: document.getElementById('viewFollowUp').value
        });
        await fetch(SCRIPT_URL, { method: 'POST', body: params, mode: 'no-cors' });
        alert("Patient Record Updated Successfully");
        loadData();
    }

    window.onload = loadData;
</script>
</body>
</html>
